---

title: explore


keywords: fastai
sidebar: home_sidebar

summary: "API details."
description: "API details."
nb_path: "nbs\02_explore.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs\02_explore.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/test_fmi/images/graphic7.PNG" alt="explore"></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Instance-Sort">Instance Sort<a class="anchor-link" href="#Instance-Sort"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Many dicom datasets have multiple slices of images for the same patient.  For example with <a href="https://www.kaggle.com/c/osic-pulmonary-fibrosis-progression">this</a> dataset each folder represents a single patient and each folder can have multiple slices.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='View sort tutorial on Kaggle (click on Kaggle icon)' %}
<a href="https://www.kaggle.com/avirdee/sort-tutorial/"><img src="images/kaggle.PNG" alt="kaggle"></a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/&#39;</span>
<span class="n">sort_items</span> <span class="o">=</span> <span class="n">get_dicom_files</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">folders</span><span class="o">=</span><span class="s1">&#39;ID00007637202177411956430&#39;</span><span class="p">)</span>
<span class="n">sort_items</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#30) [Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00007637202177411956430/1.dcm&#39;),Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00007637202177411956430/10.dcm&#39;),Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00007637202177411956430/11.dcm&#39;),Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00007637202177411956430/12.dcm&#39;),Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00007637202177411956430/13.dcm&#39;),Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00007637202177411956430/14.dcm&#39;),Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00007637202177411956430/15.dcm&#39;),Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00007637202177411956430/16.dcm&#39;),Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00007637202177411956430/17.dcm&#39;),Path(&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00007637202177411956430/18.dcm&#39;)...]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this example there are 30 images within the folder.  To view them:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We notice that the images are not in sequence.  Dicoms typically have an <code>InstanceNumber</code> which can be used to display the images in sequence.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="instance_sort" class="doc_header"><code>instance_sort</code><a href="https://github.com/asvcode/test_fmi/tree/master/test_fmi/explore.py#L12" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>instance_sort</code>(<strong><code>folder</code></strong>:<code>L'&gt;)</code>)</p>
</blockquote>
<p>Helper to sort files by instance number</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="instance_dcmread" class="doc_header"><code>instance_dcmread</code><a href="https://github.com/asvcode/test_fmi/tree/master/test_fmi/explore.py#L23" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>instance_dcmread</code>(<strong><code>folder</code></strong>:<code>L</code>)</p>
</blockquote>
<p>instance dcmread</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="instance_show" class="doc_header"><code>instance_show</code><a href="https://github.com/asvcode/test_fmi/tree/master/test_fmi/explore.py#L29" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>instance_show</code>(<strong><code>folder</code></strong>:<code>L</code>, <strong><code>nrows</code></strong>=<em><code>1</code></em>)</p>
</blockquote>
<p>Helper to display sorted files by instance number</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can simply view the images in sequence by using <a href="/test_fmi/explore.html#instance_show"><code>instance_show</code></a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="View-images">View images<a class="anchor-link" href="#View-images"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>fastai</code> has a handy method <code>from.dicoms</code> that can access dicom metadata and display this in a dataframe.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m_items</span> <span class="o">=</span> <span class="n">get_dicom_files</span><span class="p">(</span><span class="s1">&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/ID00007637202177411956430&#39;</span><span class="p">)</span>
<span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;D:/Datasets/osic-pulmonary-fibrosis-progression/train/&#39;</span>
<span class="n">dicom_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dicoms</span><span class="p">(</span><span class="n">m_items</span><span class="p">)</span>
<span class="n">dicom_dataframe</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SpecificCharacterSet</th>
      <th>ImageType</th>
      <th>SOPInstanceUID</th>
      <th>Modality</th>
      <th>Manufacturer</th>
      <th>ManufacturerModelName</th>
      <th>PatientName</th>
      <th>PatientID</th>
      <th>PatientSex</th>
      <th>DeidentificationMethod</th>
      <th>...</th>
      <th>ImageOrientationPatient3</th>
      <th>ImageOrientationPatient4</th>
      <th>ImageOrientationPatient5</th>
      <th>MultiPixelSpacing</th>
      <th>PixelSpacing1</th>
      <th>img_min</th>
      <th>img_max</th>
      <th>img_mean</th>
      <th>img_std</th>
      <th>img_pct_window</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ISO_IR 100</td>
      <td>ORIGINAL</td>
      <td>2.25.12297650151329871895440507938349160734</td>
      <td>CT</td>
      <td>GE MEDICAL SYSTEMS</td>
      <td>LightSpeed VCT</td>
      <td>(I, D, 0, 0, 0, 0, 7, 6, 3, 7, 2, 0, 2, 1, 7, 7, 4, 1, 1, 9, 5, 6, 4, 3, 0)</td>
      <td>ID00007637202177411956430</td>
      <td></td>
      <td>Table;</td>
      <td>...</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1</td>
      <td>0.652344</td>
      <td>-2000</td>
      <td>2842</td>
      <td>-1.454884</td>
      <td>1137.488858</td>
      <td>0.058094</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ISO_IR 100</td>
      <td>ORIGINAL</td>
      <td>2.25.37611372879908126511187998276199853341</td>
      <td>CT</td>
      <td>GE MEDICAL SYSTEMS</td>
      <td>LightSpeed VCT</td>
      <td>(I, D, 0, 0, 0, 0, 7, 6, 3, 7, 2, 0, 2, 1, 7, 7, 4, 1, 1, 9, 5, 6, 4, 3, 0)</td>
      <td>ID00007637202177411956430</td>
      <td></td>
      <td>Table;</td>
      <td>...</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1</td>
      <td>0.652344</td>
      <td>-2000</td>
      <td>2918</td>
      <td>19.038597</td>
      <td>1138.876560</td>
      <td>0.068130</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 67 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_dicom_image" class="doc_header"><code>get_dicom_image</code><a href="https://github.com/asvcode/test_fmi/tree/master/test_fmi/explore.py#L38" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_dicom_image</code>(<strong><code>df</code></strong>, <strong><code>key</code></strong>, <strong><code>nrows</code></strong>=<em><code>3</code></em>, <strong><code>source</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Helper to view images by key</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/test_fmi/explore.html#get_dicom_image"><code>get_dicom_image</code></a> easily allows to view images based on the chosen dataframe key.  For example we can reduce the dataframe created earlier.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pct</span> <span class="o">=</span> <span class="n">dicom_dataframe</span><span class="p">[[</span><span class="s1">&#39;PatientID&#39;</span><span class="p">,</span> <span class="s1">&#39;InstanceNumber&#39;</span><span class="p">,</span> <span class="s1">&#39;img_pct_window&#39;</span><span class="p">,</span> <span class="s1">&#39;img_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;img_std&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;img_pct_window&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pct</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PatientID</th>
      <th>InstanceNumber</th>
      <th>img_pct_window</th>
      <th>img_mean</th>
      <th>img_std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ID00007637202177411956430</td>
      <td>20</td>
      <td>0.077923</td>
      <td>109.478535</td>
      <td>1174.014672</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ID00007637202177411956430</td>
      <td>21</td>
      <td>0.075516</td>
      <td>127.095284</td>
      <td>1182.195403</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ID00007637202177411956430</td>
      <td>29</td>
      <td>0.075508</td>
      <td>210.377762</td>
      <td>1217.328780</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ID00007637202177411956430</td>
      <td>18</td>
      <td>0.075157</td>
      <td>97.442841</td>
      <td>1172.540524</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ID00007637202177411956430</td>
      <td>28</td>
      <td>0.075096</td>
      <td>212.950813</td>
      <td>1219.356338</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>View images by <code>img_pct_window</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>View by <code>img_mean</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mean</span> <span class="o">=</span> <span class="n">dicom_dataframe</span><span class="p">[[</span><span class="s1">&#39;PatientID&#39;</span><span class="p">,</span> <span class="s1">&#39;InstanceNumber&#39;</span><span class="p">,</span> <span class="s1">&#39;img_pct_window&#39;</span><span class="p">,</span> <span class="s1">&#39;img_mean&#39;</span><span class="p">,</span> <span class="s1">&#39;img_std&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;img_mean&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mean</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PatientID</th>
      <th>InstanceNumber</th>
      <th>img_pct_window</th>
      <th>img_mean</th>
      <th>img_std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ID00007637202177411956430</td>
      <td>26</td>
      <td>0.074780</td>
      <td>216.025375</td>
      <td>1223.787277</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ID00007637202177411956430</td>
      <td>27</td>
      <td>0.074970</td>
      <td>215.649502</td>
      <td>1221.412337</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ID00007637202177411956430</td>
      <td>28</td>
      <td>0.075096</td>
      <td>212.950813</td>
      <td>1219.356338</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ID00007637202177411956430</td>
      <td>29</td>
      <td>0.075508</td>
      <td>210.377762</td>
      <td>1217.328780</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ID00007637202177411956430</td>
      <td>25</td>
      <td>0.073563</td>
      <td>208.641216</td>
      <td>1222.713558</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

